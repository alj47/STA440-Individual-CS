---
title: "Individual CS"
author: "Austin Jia"
date: "11/28/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Libraries

```{r, include = FALSE}
# Installing packages
pkgTest <- function(x) {
  if (!require(x,character.only = TRUE)) {
    install.packages(x,dep=TRUE)
  }
}
pkgs <- c("jsonlite", "dplyr", "rvest", "purrr", "ggplot2", "gganimate", "ggthemes", "lubridate", "zoo", "shiny", "stringr", "mice", "VIM", "parallel", "corrplot", "MASS", "caTools", "nnet", "randomForest", "pROC", "caret", "ggpubr", "shiny", "glmnet", "RSocrata")
for (pkg in pkgs) {
  pkgTest(pkg)
}
```

```{r, include=FALSE}
library(jsonlite)
library(dplyr)
library(rvest)
library(purrr)
library(ggplot2)
library(gganimate)
library(ggthemes)
library(lubridate)
library(zoo)
library(shiny)
library(stringr)
library(mice)
library(VIM)
library(parallel)
library(corrplot)
library(MASS)
library(caTools)
library(nnet)
library(randomForest)
library(pROC)
library(caret)
library(ggpubr)
library(shiny)
library(glmnet)
library(RSocrata)
```

### Scraping

```{r}
# data <- read.socrata(
#   "https://data.cityofnewyork.us/resource/ewhs-k7um.json",
#   app_token = "6xxqTZUbdXq2WlnUEBkACtxEH",
#   email     = "alj47@duke.edu",
#   password  = "Dukeletmein123!"
# )

data = read.csv("schooldata.csv")
```

### Data Cleaning

```{r, include = FALSE}
#Renaming variable names
data = data %>% 
  rename(
    Instruction.Rating = Rigorous.Instruction.Rating,
    Teachers.Rating = Collaborative.Teachers.Rating,
    Leadership.Rating = Effective.School.Leadership.Rating,
    Community.Ties.Rating = Strong.Family.Community.Ties.Rating,
    Instruction.Rating.pct = Rigorous.Instruction...Percent.Positive,
    Teachers.Rating.pct = Collaborative.Teachers...Percent.Positive,
    Supportive.Environment.pct = Supportive.Environment...Percent.Positive,
    Leadership.Rating.pct = Effective.School.Leadership...Percent.Positive,
    Community.Ties.Rating.pct = Strong.Family.Community.Ties...Percent.Positive,
    Challenging.Curriculum.qr = Quality.Review...How.interesting.and.challenging.is.the.curriculum.,
    Effective.Teaching.qr = Quality.Review...How.effective.is.the.teaching.and.learning.,
    School.Assess.qr = Quality.Review...How.well.does.the.school.assess.what.students.are.learning.,
    Expectations.Communicated.qr = Quality.Review...How.clearly.are.high.expectations.communicated.to.students.and.staff.,
    Teachers.Cooperation.qr = Quality.Review...How.well.do.teachers.work.with.each.other.,
    Safe.Inclusive.qr = Quality.Review...How.safe.and.inclusive.is.the.school.while.supporting.social.emotional.growth.,
    Resource.Allocation.qr = Quality.Review...How.well.does.the.school.allocate.and.manage.resources.,
    Meet.Goals.qr = Quality.Review...How.well.does.the.school.identify..track..and.meet.its.goals.,
    Teacher.Development.qr = Quality.Review...How.thoughtful.is.the.school.s.approach.to.teacher.development.and.evaluation.,
    Decisions.Evaluated.qr = Quality.Review...How.well.are.school.decisions.evaluated.and.adjusted.,
    Review.Dates.qr = Quality.Review...Dates.of.Review,
    ELA.Proficiency = Average.Grade.8.English.Proficiency,
    Math.Proficiency = Average.Grade.8.Math.Proficiency,
    Principal.Experience.yrs = Years.of.principal.experience.at.this.school, 
    Teachers.3yrs.Experience = Percent.of.teachers.with.3.or.more.years.of.experience,
    Students.Chronically.Absent = Percent.of.Students.Chronically.Absent
    )


#Replacing blank levels with NAs
data <- data %>% mutate_if(is.factor, list(~factor(replace(., .=="", NA))))
```

#### Data Cleaning - Response Variable

```{r, echo = FALSE}
# Response Variable
data$Student.Achievement.Rating <- factor(data$Student.Achievement.Rating,levels = c("Not Meeting Target", "Approaching Target", "Meeting Target", "Exceeding Target", "NA"))

p_sar_old = ggplot(data, aes(factor(Student.Achievement.Rating),fill = Student.Achievement.Rating)) +
geom_bar(stat="count", position = "dodge") + 
scale_fill_brewer(palette = "Set1") + ggtitle("Student Achievement Rating Distribution") + xlab("Student Achievement Rating") + labs(fill = "Target Category") + theme(axis.text.x=element_text(angle=45, hjust=1))

#Combining Factor Levels
levels(data$Student.Achievement.Rating) <- list("Not Meeting Target"=c("Not Meeting Target", "Approaching Target"), "Meeting Target"=c("Meeting Target", "Exceeding Target"))

p_sar_old
```

I merged the four response categories of "Not Meeting Target", "Approaching Target", "Meeting Target", and "Exceeding Target" into a binary "Not Meeting Target" and "Meeting Target". I did this for a couple reasons. First, this simplifies the classification problem down from multinomial logistic regression to binary logistic regression, which features simpler interpretations. Second, "Not Meeting Target" only had 39 occurences; with so many predictors, my model would surely have low power. Finally, while it is nice to have a gradient of exceptional to mediocre schools, from a policymaker's perspective, it is more expedient to allocate a budget to all schools that fall below a certain threshold. 

#### Data Cleaning - Explanatory Variables

```{r, echo=FALSE}
#Explanatory Variables

#Collinearity Matrix
data_numeric = data[ , purrr::map_lgl(data, is.numeric)]
corrplot(cor(data_numeric, use="pairwise.complete.obs"), method = "circle", tl.cex=0.5)

#Removing Covariates
redundant_cols = c("Instruction.Rating", "Supportive.Environment.Rating", "Community.Ties.Rating", "Teachers.Rating", "Leadership.Rating", "Trust.Rating", "DBN", "Percent.HRA.Eligible", "Effective.Teaching.qr", "Expectations.Communicated.qr", "Safe.Inclusive.qr", "Meet.Goals.qr", "Decisions.Evaluated.qr", "Challenging.Curriculum.qr", "School.Assess.qr", "Teachers.Cooperation.qr", "Resource.Allocation.qr", "Teacher.Development.qr", "Review.Dates.qr", "Students.Chronically.Absent", "Percent.in.Temp.Housing", "School.Type", "ELA.Proficiency", "Math.Proficiency", "School.Name")
data = data[ , -which(names(data) %in% redundant_cols)]
```

I decided to remove the above covariates for a couple reasons. First, as the correlation matrix demonstrates, there is high correlation between several rating metrics and economic need proxies, so I eliminated all but one to address collinearity and reduce variance. For example, Supportive.Environment.Rating and Supportive.Environment.Rating.pct measure the same metric in different formats, and percent in temporary housing and percent HRA elgible are both proxies for economic need. Second, as the regression "one-in-ten" rule-of-thumb dictates, I should have at most one predictor for every 10 response-variable combinations. Third, I removed all the Quality Review covariates because (1) they are likely highly correlated with each other, (2) the data dictionary does not define what constitutes such subjective evaluation metrics, and (3) these metrics are likely highly inconsistent from school to school, so I felt that they did not add much value to the model. I removed these covariates instead of just excluding them from the model to improve mice runtime.

### Missing Data

```{r, include = FALSE}
sum(is.na(data)) / (dim(data)[1] * dim(data)[2])
nrow(data[complete.cases(data), ])
nrow(data[complete.cases(data), ])/nrow(data)
```

```{r, echo=FALSE}
missing.prop <- apply(data, MARGIN = 2, FUN = function(x) { sum(is.na(x)) })
missing.prop <- missing.prop / dim(data)[1]
missing.prop <- data.frame("prop" = missing.prop,
                           "var" = names(data))
ggplot(missing.prop, aes(x = reorder(var, -prop), y = prop)) + 
  geom_bar(stat = "identity") +
  theme(axis.text.x=element_text(angle=90,hjust=1,vjust=0.5)) + 
  geom_col(colour = "black", fill = "#FF6666") + 
  xlab("Covariate") + 
  ylab("Proportion Missing") +
  ggtitle("The Proportion of Missing Values for Each Covariate")
```

Some initial data exploration tells us that our data is missing about 2% of its values. That 2% missing data is distributed in such a way that only 84% of our observations (406 schools) have complete information. The plot showcases some of the most problematic covariates in terms of missing data. 

```{r, echo=FALSE}
#Not MCAR
marginplot(data[, c("Teacher.Attendance.Rate", "Teachers.3yrs.Experience")], col = mdc(1:2), cex.numbers = 1.2, pch = 19)
```

```{r, include=FALSE}
#Mean and Mode Imputation 

calc.mode <- function(x) {
  ux <- na.omit(unique(x))
  ux[which.max(tabulate(match(x, ux)))]
}
impute_covariates <- as.character(missing.prop[(missing.prop$prop <= 0.05) & (missing.prop$prop > 0), ]$var)
data2 <- as.data.frame(data)
for (var in impute_covariates) {
  print(var)
  if (is.factor(data2[[var]])) {
    data2[is.na(data2[[var]]), var] <- calc.mode(data2[[var]])
  } else {
    data2[is.na(data[[var]]), var] <- mean(data[[var]], na.rm = TRUE)
  }
}
```

```{r, include=FALSE}
#Mice
init = mice(data2, maxit=0) 
meth = init$method
predM = init$predictorMatrix
meth[c("Student.Achievement.Rating")]="logreg" 
data3 <- mice(data2, m=4, method=meth, predictorMatrix=predM, maxit = 5)

data5 <- complete(data3)
```

Looking at the distributions, we can see that the missngness of Teacher Attendance and Teacher Experience seem dependent, indicating that the covariates are not MCAR. This could be because when teachers are absent during data collection days, then teacher experience may not be collected. Given the fact that our sample size is already so limited, I decided to use Multiple Imputation methods instead of tossing out valuable information. First, to improve runtime, I mean/mode-imputed missing values in covariates missing less than 5% data, which wouldn't introduce much bias=. Then, I used MICE, or Multiple Imputation using Chained Equations, to created our imputed datasets. I created 4 imputed datasets, roughly corresponding to the percent of missing data. 

### Visualizations/EDA

```{r, include = FALSE}
#Response Variable
p_sar = ggplot(data5, aes(factor(Student.Achievement.Rating),fill = Student.Achievement.Rating)) +
geom_bar(stat="count", position = "dodge") + 
scale_fill_brewer(palette = "Set1") + ggtitle("Student Achievement Rating Distribution") + xlab("Student Achievement Rating") + labs(fill = "Target Category") + theme(axis.text.x=element_text(angle=45, hjust=1))

#Enrollment
p_enrollment = ggplot(data5,aes(x=Enrollment,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Enrollment[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Enrollment[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Enrollment")+
  ggtitle("Distribution of Enrollment")+
  theme_classic() + labs(fill = "Student Achievement Rating")

#Racial Breakdown
p_asian = ggplot(data5,aes(x=Percent.Asian,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Asian[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Asian[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Asian")+
  ggtitle("Distribution of Percentage Asian")+
  theme_classic() + labs(fill = "Student Achievement Rating")

p_hispanic = ggplot(data5,aes(x=Percent.Hispanic,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Hispanic[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Hispanic[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Hispanic")+
  ggtitle("Distribution of Percentage Hispanic")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_black = ggplot(data5,aes(x=Percent.Black,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Black[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Black[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent Black")+
  ggtitle("Distribution of Percentage Black")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_white = ggplot(data5,aes(x=Percent.White,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.White[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.White[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Percent White")+
  ggtitle("Distribution of Percentage White")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

#Faculty 
p_principal_exp = ggplot(data5,aes(x=Principal.Experience.yrs,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Principal.Experience.yrs[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Principal.Experience.yrs[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Principal Experience (yrs)")+
  ggtitle("Distribution of Principal Experience")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_teacher_exp = ggplot(data5,aes(x=Teachers.3yrs.Experience,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Teachers.3yrs.Experience[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Teachers.3yrs.Experience[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Teacher Experience (% More than 3 yrs)")+
  ggtitle("Distribution of Teacher Experience")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_selfcontained = ggplot(data5,aes(x=Percent.Self.Contained,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Self.Contained[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Self.Contained[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Self-Contained Classrooms")+
  ggtitle("Distribution of Self-Contained Classrooms")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_teacherattendance = ggplot(data5,aes(x=Teacher.Attendance.Rate,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Teacher.Attendance.Rate[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Teacher.Attendance.Rate[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Teacher Attendance Rate")+
  ggtitle("Distribution of Teacher Attendance Rate")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

#Student Composition
p_econ = ggplot(data5,aes(x=Economic.Need.Index,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Economic.Need.Index[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Economic.Need.Index[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Economic Need Index")+
  ggtitle("Distribution of Economic Need Index")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_esl = ggplot(data5,aes(x=Percent.English.Language.Learners,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.English.Language.Learners[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.English.Language.Learners[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% English Language Learners")+
  ggtitle("Distribution of English Language Learners")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_swd = ggplot(data5,aes(x=Percent.Students.with.Disabilities,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Students.with.Disabilities[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Students.with.Disabilities[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Students with Disabilities")+
  ggtitle("Distribution of Students with Disabilities")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_swd

p_studentattendance = ggplot(data5,aes(x=Student.Attendance.Rate,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Student.Attendance.Rate[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Student.Attendance.Rate[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "Student Attendance Rate")+
  ggtitle("Distribution of Student Attendance Rate")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_undercredited = ggplot(data5,aes(x=Percent.Overage..Undercredited,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Percent.Overage..Undercredited[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Percent.Overage..Undercredited[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Undercredited")+
  ggtitle("Distribution of Undercredited Students")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

#Ratings
p_instruction_rating = ggplot(data5,aes(x=Instruction.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Instruction.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Instruction.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Approval of Instruction Rating")+
  ggtitle("Distribution of Instruction Rating Approval")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_teachers = ggplot(data5,aes(x=Teachers.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Teachers.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Teachers.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Approval of Teacher Rating")+
  ggtitle("Distribution of Teacher Rating Approval")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_supportive = ggplot(data5,aes(x=Supportive.Environment.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Supportive.Environment.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Supportive.Environment.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Approval of Supportive Environment Rating")+
  ggtitle("Distribution of Supportive Environment Rating Approval")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_leadership = ggplot(data5,aes(x=Leadership.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Leadership.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Leadership.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Approval of Leadership Rating")+
  ggtitle("Distribution of Leadership Rating Approval")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_community = ggplot(data5,aes(x=Community.Ties.Rating.pct,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Community.Ties.Rating.pct[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Community.Ties.Rating.pct[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Approval of Community Ties Rating")+
  ggtitle("Distribution of Community Ties Rating Approval")+
  theme_classic()+ labs(fill = "Student Achievement Rating")

p_trust = ggplot(data5,aes(x=Trust...Percent.Positive,fill=factor(Student.Achievement.Rating)))+geom_density(alpha=0.25)+
  geom_vline(aes(xintercept=mean(Trust...Percent.Positive[Student.Achievement.Rating=="Not Meeting Target"],na.rm=T)),color="red",linetype="dashed",lwd=1)+
  geom_vline(aes(xintercept=mean(Trust...Percent.Positive[Student.Achievement.Rating=="Meeting Target"],na.rm=T)),color="green",linetype="dashed",lwd=1)+
  scale_x_continuous(breaks = seq(8,15,1))+
  xlab(label = "% Approval of Trust Rating")+
  ggtitle("Distribution of Trust Rating Approval")+
  theme_classic()+ labs(fill = "Student Achievement Rating")
```

### Model Selection and Performance

```{r, include = FALSE}
# Split into Training and Testing
set.seed(12)
sample = sample.split(data5, SplitRatio = .75)
train = subset(data5, sample == TRUE)
test  = subset(data5, sample == FALSE)
```

```{r, include = FALSE}
set.seed(6345)
#Full Model
glm.full = glm(Student.Achievement.Rating ~., data = train, family = binomial)
glm.full.coef = coef(glm.full)

#AIC
glm.aic = step(glm.full,direction="backward", data=train, cluster.seed = 6)
glm.aic.coef = coef(glm.aic)

#Ridge and Lasso
X.train = train
X.train$Student.Achievement.Rating = NULL
X.train$School.Name = NULL
y.train = train$Student.Achievement.Rating
x.train = model.matrix( ~ ., X.train)

#Ridge
set.seed(15)
cv.out <- cv.glmnet(x.train, y.train, alpha = 0, family = "binomial")
bestlamridge <- cv.out$lambda.min
bestlamridge

glm.ridge <-glmnet(x = x.train, y = y.train, alpha = 0, lambda = bestlamridge, family = "binomial" )
glm.ridge.coef = coef(glm.ridge)

#Lasso
set.seed(15)
cv.out <- cv.glmnet(x.train, y.train, alpha = 1, family = "binomial")
bestlamlasso <- cv.out$lambda.min
bestlamlasso
glm.lasso <-glmnet(x = x.train, y = y.train, alpha = 1, lambda = bestlamlasso, family = "binomial" )
glm.lasso.coef = coef(glm.lasso)

# Random Forest
rf <- randomForest(Student.Achievement.Rating ~ ., data = train, ntree = 100, 
    importance = TRUE)
summary(rf)
varImpPlot(rf)
```

```{r, include = FALSE}
#Predictions on Validation Set and Confusion Matrices
set.seed(1346)

# Logistic Full Model
glm.full.prob <- predict(glm.full, test, type = "response")
glm.full.pred <- rep("Not Meeting Target", 138)
glm.full.pred[glm.full.prob > 0.5] <- "Meeting Target"
cm.full = table(glm.full.pred, test$Student.Achievement.Rating)
accuracy.full = mean(glm.full.pred == test$Student.Achievement.Rating)
mce.full = mean(glm.full.pred != test$Student.Achievement.Rating)

# Logistic AIC
glm.aic.prob <- predict(glm.aic, test, type = "response")
glm.aic.pred <- rep("Not Meeting Target", 138)
glm.aic.pred[glm.aic.prob > 0.5] <- "Meeting Target"
cm.aic = table(glm.full.pred,test$Student.Achievement.Rating)
accuracy.aic = mean(glm.aic.pred == test$Student.Achievement.Rating)
mce.aic = mean(glm.aic.pred != test$Student.Achievement.Rating)

#Logistic Ridge
X.test = test
X.test$Student.Achievement.Rating = NULL
X.test$School.Name = NULL
y.test = test$Student.Achievement.Rating
x.test = model.matrix( ~ ., X.test)


glm.ridge.prob <- predict(glm.ridge, s = 4, newx = x.test)
glm.ridge.pred <- rep("Not Meeting Target", 138)
glm.ridge.pred[glm.ridge.prob > 0.5] <- "Meeting Target"
cm.ridge = table(glm.ridge.pred,test$Student.Achievement.Rating)
accuracy.ridge = mean(glm.ridge.pred == test$Student.Achievement.Rating)
mce.ridge = mean(glm.ridge.pred != test$Student.Achievement.Rating)

#Logistic Lasso
glm.lasso.prob <- predict(glm.lasso, s = 4, newx = x.test)
glm.lasso.pred <- rep("Not Meeting Target", 138)
glm.lasso.pred[glm.lasso.prob > 0.5] <- "Meeting Target"
cm.lasso = table(glm.lasso.pred,test$Student.Achievement.Rating)
accuracy.lasso = mean(glm.lasso.pred == test$Student.Achievement.Rating)
mce.lasso = mean(glm.lasso.pred != test$Student.Achievement.Rating)

# Random Forest
print(rf)
accuracy.rf = .532
mce.rf = .176

summary(glm.full)
summary(glm.aic)
glm.lasso.coef
```

```{r, echo = FALSE}
#Tabulating Results
Model <- c("Logit Full Model", "Logit AIC", "Logit Ridge", "Logit Lasso", "Random Forest")  # vector containing names of models

MCE <- c(mce.full, mce.aic, mce.ridge, mce.lasso, mce.rf)
Accuracy <- c(accuracy.full, accuracy.aic, accuracy.ridge, accuracy.lasso, accuracy.rf)

metrics <- data.frame(Model, MCE, Accuracy) 

knitr::kable(metrics, digits = 5) 
cm.ridge
```

As we can see, accuracy is the highest with the ordinary logistic model. I decided to sacrifice 1% prediction accuracy in favor of a ridge-regularized logit regression for two reasons (1) after reading some papers my prior belief is that all the included covariates have at least a weak impact on the response and (2) ridge regularization handles the collinearity of my covariates which inflated variance for the ordinary logit. Below is the model specification with 20 covariates. 

```{r}
glm.ridge.coef
```


$$
\mbox{logit}(Pr(y_i = 1)) = \beta_0 + \beta_1*Enrollment + \beta_2*Instruction.Rating.pct + \beta_3*Teachers.Rating.pct + \\ \beta_4*Supportive.Environment.pct 
+ \beta_5*Leadership.Rating.pct + \beta_6*Community.Ties.Rating.pct \\ + \beta_7*Trust.pct + \beta_8 * Percent.English.Language.Learners \\ 
+ \beta_9*Percent.Students.with.Disabilites + \beta_{10}*Percent.Self.Contained.Classrooms \\ 
+ \beta_{11}*Economic.Need.Index + \beta_{12}*Percent.Undercredited \\ + \beta_{13}*Percent.Asian + \beta_{14}*Percent.Black + \beta_{15}*Percent.Hispanic + \beta_{16}*Percent.White \\ + \beta_{17}*Principal.Experience.yrs + \beta_{18}*Teachers.Experience.yrs \\ + \beta_{19}*Student.Attendance.Rate + \beta_{20}*Teacher.Attendance.Rate
$$

```{r, include = FALSE}
#Manipulating Ridge
tmp_coeffs <- coef(glm.ridge, s = "bestlamridge")
glm.ridge.coef = data.frame(name = tmp_coeffs@Dimnames[[1]][tmp_coeffs@i + 1], coefficient = tmp_coeffs@x)

glm.ridge.coef = as.data.frame(t(glm.ridge.coef)) 
colnames(glm.ridge.coef) <- as.character(unlist(glm.ridge.coef[1,]))
glm.ridge.coef = glm.ridge.coef[-1, ]

glm.ridge.coef[] <- lapply(glm.ridge.coef, function(x) {
    if(is.factor(x)) as.numeric(as.character(x)) else x
})

glm.ridge.coef$Intercept = glm.ridge.coef[,1]
```

```{r, include = FALSE}
#Manipulating Lasso
tmp_coeffs <- coef(glm.lasso, s = "bestlamlasso")
glm.lasso.coef = data.frame(name = tmp_coeffs@Dimnames[[1]][tmp_coeffs@i + 1], coefficient = tmp_coeffs@x)

glm.lasso.coef = as.data.frame(t(glm.lasso.coef)) 
colnames(glm.lasso.coef) <- as.character(unlist(glm.lasso.coef[1,]))
glm.lasso.coef = glm.lasso.coef[-1, ]

glm.lasso.coef[] <- lapply(glm.lasso.coef, function(x) {
    if(is.factor(x)) as.numeric(as.character(x)) else x
})

glm.lasso.coef$Intercept = glm.lasso.coef[,1]
```

```{r,echo = FALSE}
glm.ridge.coef.odds = exp(1)^coef(glm.ridge)
```

### Conclusions

There were several aspects of my model results that surprised me. A 1% increase in teacher approval rating, community ties rating, trust rating, and teacher experience decreased a school's odds of meeting a target by multiplicative factors of .57, .35, 34, and .39, respectively. I posit several hypotheses to explain these surprises. First, students generally approve of easier teachers who don't end up preparing their students all that well for their exams. For example, my mother, an accounting professor with a famously low student approval rating, actually sees a large proportion of her students passing the CPA exam. Second, students that are more competitive and thus high-performing are most likely to be less trusting by nature. Third, it is possible that teachers are getting outdated in their educational ways as assessment types are beginning to evaluate fundamentally different student abilities. Finally, schools that are too responsive to community wants could be harmed. For example, my school district, which prides itself on its brand of strong community ties, dumbed down the curriculum in response to parent complaints about stress, which lowered the school quality. 

However, on the whole, my model results are in line with accepted pedagogical doctrine. For race, increasing the Asian, Black, Hispanic, and White composition by 1% changes the odds of a school meeting a target by a multiplicative factor of 6.79, .42, 1.83, and .35, respectively. A 1% increase in the Economic Need Index decreases the odds of a school meeting a target by a multiplicative factor of .29. Overcrowded schools marginally harms its performance; every additional student decreases the odds of a school meeting a target by .99. With respect to student composition, a 1% increase in ESL and disabled students changed the school's odds of meeting a target by multiplicative factors of .28 and 2.04, respectively. With respect to the more subjective metrics, a 1% increase in the approval rate of a school's instruction rating, supportive environment, and leadership increases the school's odds of meeting a target by factors of 252, 553, and 1.4. Finally, a 1% increase in student and teacher attendance rate increases a school's odds of meeting a target by 21,724 and 2,526,725,418, respectively. 

From the magnitude of the coefficients, it seems that policymakers have their work cut out for them. They should focus on revamping school curriculum, fostering a supportive environment, and find ways to incentivize attendance on both the teacher and student front. With such strategic and targeted investments, New York City can be well on its way to eliminating the performance gap in its high school educational system. 

Find my visualization of my results here: 

```{r, include = FALSE}
#Function to display probability
logit2prob <- function(logit){
  odds <- exp(logit)
  prob <- odds / (1 + odds)
  return(prob)
}
```


```{r}
# Shiny Visualization 

ui = fluidPage(
  title = "NYC High School Performance",
  titlePanel("NYC High School Performance"),
  sidebarLayout(
    sidebarPanel = sidebarPanel(
      h4("Viewable Statistics"),
      helpText("View how changing school parameters affects whether it does or doesn't meet standards"),
      selectInput("selection", "Select something", choices = c("School Size", "Teachers Rating", "Supportive Environment", "Leadership", "Community Ties", "Trust", "Percent English Language Learners", "Percent Students with Disabilities", "Percent Self-Contained Classrooms", "Percent Undercredited" , "Race - Asian", "Race - Black", "Race - Hispanic", "Race - White","Economic Need Index", "Principal Experience", "Instruction Rating", "Student Attendance Rate", "Teacher Attendance Rate")),
      conditionalPanel(
        "input.selection == 'School Size'",
        sliderInput("slider_enrollment", "Enrollment", min = min(data5$Enrollment), max = max(data5$Enrollment), value = 100, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Race - Asian'",
        sliderInput("slider_asian", "Asian Percentage", min = min(data5$Percent.Asian), max = max(data5$Percent.Asian), value = 50, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Race - Black'",
        sliderInput("slider_black", "Black Percentage", min = min(data5$Percent.Black), max = max(data5$Percent.Black), value = 50, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Economic Need Index'",
        sliderInput("slider_economic", "Economic Need Index", min = min(data5$Economic.Need.Index), max = max(data5$Economic.Need.Index), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Principal Experience'",
        sliderInput("slider_principal", "Principal Experience", min = min(data5$Principal.Experience.yrs), max = max(data5$Principal.Experience.yrs), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Instruction Rating'",
        sliderInput("slider_instruction", "Percent Approval of Instruction", min = min(data5$Instruction.Rating.pct), max = max(data5$Instruction.Rating.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Teachers Rating'",
        sliderInput("slider_teachers", "Percent Approval of Teachers", min = min(data5$Teachers.Rating.pct), max = max(data5$Teachers.Rating.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Supportive Environment'",
        sliderInput("slider_supportive", "Percent Approval that School Environment is Supportive", min = min(data5$Supportive.Environment.pct), max = max(data5$Supportive.Environment.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Leadership'",
        sliderInput("slider_leadership", "Percent Approval of Leadership in School", min = min(data5$Leadership.Rating.pct), max = max(data5$Leadership.Rating.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Community Ties'",
        sliderInput("slider_community", "Percent Belief that school has strong community ties", min = min(data5$Community.Ties.Rating.pct), max = max(data5$Community.Ties.Rating.pct), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Trust'",
        sliderInput("slider_trust", "Percent Approval in Trust of School", min = min(data5$Trust...Percent.Positive), max = max(data5$Trust...Percent.Positive), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Percent English Language Learners'",
        sliderInput("slider_esl", "Percent English Language Learners", min = min(data5$Percent.English.Language.Learners), max = max(data5$Percent.English.Language.Learners), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Percent Students with Disabilities'",
        sliderInput("slider_swd", "Percent Students with Disabilities", min = min(data5$Percent.Students.with.Disabilities), max = max(data5$Percent.Students.with.Disabilities), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Percent Self-Contained Classrooms'",
        sliderInput("slider_selfcontained", "Percent Self-Contained Classrooms", min = min(data5$Trust...Percent.Positive), max = max(data5$Trust...Percent.Positive), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Percent Undercredited'",
        sliderInput("slider_undercredited", "Percent Undercredited", min = min(data5$Percent.Overage..Undercredited), max = max(data5$Percent.Overage..Undercredited), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Race - Hispanic'",
        sliderInput("slider_hispanic", "Percent Hispanic", min = min(data5$Percent.Hispanic), max = max(data5$Percent.Hispanic), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Race - White'",
        sliderInput("slider_white", "Percent White", min = min(data5$Percent.White), max = max(data5$Percent.White), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Student Attendance Rate'",
        sliderInput("slider_studentattendance", "Student Attendance Rate", min = min(data5$Student.Attendance.Rate), max = max(data5$Student.Attendance.Rate), value = .5, ticks = FALSE)
      ),
      conditionalPanel(
        "input.selection == 'Teacher Attendance Rate'",
        sliderInput("slider_teacherattendance", "Teacher Attendance Rate", min = min(data5$Trust...Percent.Positive), max = max(data5$Trust...Percent.Positive), value = .5, ticks = FALSE)
      )
    ),
    mainPanel = mainPanel(
      textOutput("selected_var"),
      conditionalPanel(
        condition = "input.selection == 'School Size'",
        textOutput("probability_enrollment")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Asian'",
        textOutput("probability_asian")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Black'",
        textOutput("probability_black")
      ),
      conditionalPanel(
        condition = "input.selection == 'Principal Experience'",
        textOutput("probability_principal")
      ),
      conditionalPanel(
        condition = "input.selection == 'Economic Need Index'",
        textOutput("probability_economic")
      ),
      conditionalPanel(
        condition = "input.selection == 'Instruction Rating'",
        textOutput("probability_instruction")
      ),
      conditionalPanel(
        condition = "input.selection == 'Teachers Rating'",
        textOutput("probability_teachers")
      ),
      conditionalPanel(
        condition = "input.selection == 'Supportive Environment'",
        textOutput("probability_supportive")
      ),
      conditionalPanel(
        condition = "input.selection == 'Leadership'",
        textOutput("probability_leadership")
      ),
      conditionalPanel(
        condition = "input.selection == 'Community Ties'",
        textOutput("probability_community")
      ),
      conditionalPanel(
        condition = "input.selection == 'Trust'",
        textOutput("probability_trust")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent English Language Learners'",
        textOutput("probability_esl")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Students with Disabilities'",
        textOutput("probability_swd")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Self-Contained Classrooms'",
        textOutput("probability_selfcontained")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Undercredited'",
        textOutput("probability_undercredited")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Hispanic'",
        textOutput("probability_hispanic")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - White'",
        textOutput("probability_white")
      ),
      conditionalPanel(
        condition = "input.selection == 'Student Attendance Rate'",
        textOutput("probability_studentattendance")
      ),
      conditionalPanel(
        condition = "input.selection == 'Teacher Attendance Rate'",
        textOutput("probability_teacherattendance")
      ),
      conditionalPanel(
        condition = "input.selection == 'School Size'",
        plotOutput("enrollment_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Asian'",
        plotOutput("asian_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Black'",
        plotOutput("black_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Principal Experience'",
        plotOutput("principal_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Economic Need Index'",
        plotOutput("economic_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Instruction Rating'",
        plotOutput("instruction_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Teachers Rating'",
        plotOutput("teachers_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Supportive Environment'",
        plotOutput("supportive_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Leadership'",
        plotOutput("leadership_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Community Ties'",
        plotOutput("community_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Trust'",
        plotOutput("trust_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent English Language Learners'",
        plotOutput("esl_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Students with Disabilities'",
        plotOutput("swd_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Self-Contained Classrooms'",
        plotOutput("selfcontained_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Percent Undercredited'",
        plotOutput("undercredited_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - Hispanic'",
        plotOutput("hispanic_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Race - White'",
        plotOutput("white_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Student Attendance Rate'",
        plotOutput("studentattendance_plot")
      ),
      conditionalPanel(
        condition = "input.selection == 'Teacher Attendance Rate'",
        plotOutput("teacherattendance_plot")
      ),
      textOutput("plot_explanation")
    )
  )
)

server = function(input, output) {
  output$selected_var <- renderText({ 
    paste("You have selected", input$selection)
  })
  output$probability_enrollment <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_enrollment * glm.ridge.coef$Enrollment[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_asian <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_asian * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Enrollment) * glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_black <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$black * glm.ridge.coef$black[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Enrollment)*glm.ridge.coef$Percent.Enrollment[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_principal <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_principal * glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_economic <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_economic * glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_instruction <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_instruction * glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_teachers <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_teachers*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Enrollment) * glm.ridge.coef$Enrollment[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] +  mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_supportive <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_supportive * glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_leadership <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_leadership * glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_community <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_community * glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_trust <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_trust * glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_esl <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_esl * glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_swd <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_swd * glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_selfcontained <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_selfcontained * glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_undercredited <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_undercredited * glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_hispanic <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_hispanic * glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_white <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_white * glm.ridge.coef$Percent.White[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$probability_studentattendance <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_studentattendance * glm.ridge.coef$Student.Attendance.Rate[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Teacher.Attendance.Rate)*glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]]), 3)) 
  })
  output$probability_teacherattendance <- renderText({ 
    paste("Holding all else equal, this school has a probability of meeting the target of", round(logit2prob(glm.ridge.coef$Intercept[[1]] + input$slider_teacherattendance * glm.ridge.coef$Teacher.Attendance.Rate[[1]] + mean(data5$Instruction.Rating.pct)*glm.ridge.coef$Instruction.Rating.pct[[1]] + mean(data5$Supportive.Environment.pct)*glm.ridge.coef$Supportive.Environment.pct[[1]] + mean(data5$Community.Ties.Rating.pct)*glm.ridge.coef$Community.Ties.Rating.pct[[1]] + mean(data5$Percent.English.Language.Learners)*glm.ridge.coef$Percent.English.Language.Learners[[1]] + mean(data5$Percent.Self.Contained)*glm.ridge.coef$Percent.Self.Contained[[1]] + mean(data5$Percent.Overage..Undercredited)*glm.ridge.coef$Percent.Overage..Undercredited[[1]] + mean(data5$Percent.Asian) * glm.ridge.coef$Percent.Asian[[1]] + mean(data5$Percent.Black)*glm.ridge.coef$Percent.Black[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Percent.Hispanic)*glm.ridge.coef$Percent.Hispanic[[1]] + mean(data5$Percent.White)*glm.ridge.coef$Percent.White[[1]] + mean(data5$Teachers.3yrs.Experience)*glm.ridge.coef$Teachers.3yrs.Experience[[1]] + mean(data5$Enrollment)*glm.ridge.coef$Enrollment[[1]] + mean(data5$Teachers.Rating.pct)*glm.ridge.coef$Teachers.Rating.pct[[1]] + mean(data5$Leadership.Rating.pct)*glm.ridge.coef$Leadership.Rating.pct[[1]] + mean(data5$Trust...Percent.Positive)*glm.ridge.coef$Trust...Percent.Positive[[1]] + mean(data5$Percent.Students.with.Disabilities)*glm.ridge.coef$Percent.Students.with.Disabilities[[1]] + mean(data5$Economic.Need.Index)*glm.ridge.coef$Economic.Need.Index[[1]] + mean(data5$Principal.Experience.yrs)*glm.ridge.coef$Principal.Experience.yrs[[1]] + mean(data5$Student.Attendance.Rate)*glm.ridge.coef$Student.Attendance.Rate[[1]]), 3)) 
  })
  output$enrollment_plot <- renderPlot(p_enrollment + geom_vline(aes(xintercept = input$slider_enrollment), colour = "blue", size = 1))
  output$asian_plot <- renderPlot(p_asian + geom_vline(aes(xintercept = input$slider_asian), colour = "blue", size = 1))
  output$black_plot <- renderPlot(p_black + geom_vline(aes(xintercept = input$slider_black), colour = "blue", size = 1))
  output$principal_plot <- renderPlot(p_principal_exp + geom_vline(aes(xintercept = input$slider_principal), colour = "blue", size = 1))
  output$economic_plot <- renderPlot(p_econ + geom_vline(aes(xintercept = input$slider_economic), colour = "blue", size = 1))
  output$instruction_plot <- renderPlot(p_instruction_rating + geom_vline(aes(xintercept = input$slider_instruction), colour = "blue", size = 1))
  output$teachers_plot <- renderPlot(p_teachers + geom_vline(aes(xintercept = input$slider_teachers), colour = "blue", size = 1))
  output$supportive_plot <- renderPlot(p_supportive + geom_vline(aes(xintercept = input$slider_supportive), colour = "blue", size = 1))
  output$leadership_plot <- renderPlot(p_leadership + geom_vline(aes(xintercept = input$slider_leadership), colour = "blue", size = 1))
  output$community_plot <- renderPlot(p_community + geom_vline(aes(xintercept = input$slider_community), colour = "blue", size = 1))
  output$trust_plot <- renderPlot(p_trust + geom_vline(aes(xintercept = input$slider_trust), colour = "blue", size = 1))
  output$esl_plot <- renderPlot(p_esl + geom_vline(aes(xintercept = input$slider_esl), colour = "blue", size = 1))
  output$swd_plot <- renderPlot(p_swd + geom_vline(aes(xintercept = input$slider_swd), colour = "blue", size = 1))
  output$selfcontained_plot <- renderPlot(p_selfcontained + geom_vline(aes(xintercept = input$slider_selfcontained), colour = "blue", size = 1))
  output$undercredited_plot <- renderPlot(p_undercredited + geom_vline(aes(xintercept = input$slider_undercredited), colour = "blue", size = 1))
  output$hispanic_plot <- renderPlot(p_hispanic + geom_vline(aes(xintercept = input$slider_hispanic), colour = "blue", size = 1))
  output$white_plot <- renderPlot(p_white + geom_vline(aes(xintercept = input$slider_white), colour = "blue", size = 1))
  output$studentattendance_plot <- renderPlot(p_studentattendance + geom_vline(aes(xintercept = input$slider_studentattendance), colour = "blue", size = 1))
  output$teacherattendance_plot <- renderPlot(p_teacherattendance + geom_vline(aes(xintercept = input$slider_teacherattendance), colour = "blue", size = 1))
  output$plot_explanation <- renderText({
    paste("This plot compares the distribution of schools that have met versus not met the target with respect to the parameter chosen. The blue vertical line indicates the parameter level that you have indicated.")
  })
}

shinyApp(ui, server)
```


### OH Questions
- Huge Odds ratio for student and teacher attendance
- Why are results varying even though i set a seed

